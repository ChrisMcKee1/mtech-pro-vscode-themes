# Fix Evening Espresso - Replace wrong cream backgrounds with proper dark colors
# This fixes the conversion script's flaw where #EDE4DB → #3E2723 and #3E2723 → #F5EFE7
# caused some backgrounds to incorrectly become #F5EFE7 (cream)

$espressoPath = "..\themes\Evening Espresso.json"
$content = Get-Content $espressoPath -Raw

Write-Host "Fixing Evening Espresso backgrounds..." -ForegroundColor Cyan

# Properties that should have DARK backgrounds (#3E2723) not cream (#F5EFE7)
# Pattern: Replace "propertyName": "#F5EFE7" with "propertyName": "#3E2723"
# But ONLY for background/border/fill properties, NOT foreground properties

$backgroundProps = @(
    'button\.separator',
    'charts\.lines',
    'chat\.avatarBackground',
    'checkbox\.background',
    'commandCenter\.activeBackground',
    'commandCenter\.border',
    'commandCenter\.inactiveBackground',
    'debugExceptionWidget\.background',
    'debugIcon\.breakpointDisabledForeground',
    'debugToolBar\.background',
    'diffEditor\.diagonalFill',
    'dropdown\.background',
    'dropdown\.listBackground',
    'editor\.inlineValuesBackground',
    'editor\.linkedEditingBackground',
    'editorGroup\.border',
    'editorGroupHeader\.border',
    'editorGroupHeader\.tabsBackground',
    'editorGroupHeader\.tabsBorder',
    'editorHint\.border',
    'editorHoverWidget\.background',
    'editorHoverWidget\.border',
    'editorIndentGuide\.background',
    'editorInfo\.border',
    'editorInlayHint\.background',
    'editorInlayHint\.parameterBackground',
    'editorInlayHint\.typeBackground',
    'editorLightBulbAutoFix\.foreground',
    'editorLineNumber\.dimmedForeground',
    'editorMarkerNavigation\.background',
    'editorMarkerNavigationError\.background',
    'editorMarkerNavigationInfo\.background',
    'editorMarkerNavigationWarning\.background',
    'editorOverviewRuler\.border',
    'editorPane\.background',
    'editorRuler\.foreground',
    'editorStickyScroll\.background',
    'editorStickyScroll\.shadow',
    'editorStickyScrollHover\.background',
    'editorSuggestWidget\.background',
    'editorSuggestWidget\.border',
    'editorWarning\.border',
    'editorWhitespace\.foreground',
    'editorWidget\.background',
    'editorWidget\.border',
    'editorWidget\.foreground',
    'extensionButton\.separator',
    'focusBorder',
    'gitDecoration\.addedResourceForeground',
    'gitDecoration\.conflictingResourceForeground',
    'gitDecoration\.deletedResourceForeground',
    'gitDecoration\.ignoredResourceForeground',
    'gitDecoration\.modifiedResourceForeground',
    'gitDecoration\.renamedResourceForeground',
    'gitDecoration\.stageDeletedResourceForeground',
    'gitDecoration\.stageModifiedResourceForeground',
    'gitDecoration\.submoduleResourceForeground',
    'gitDecoration\.untrackedResourceForeground',
    'input\.background',
    'input\.border',
    'input\.placeholderForeground',
    'inputOption\.activeBackground',
    'inputOption\.activeBorder',
    'inputValidation\.errorBackground',
    'inputValidation\.errorBorder',
    'inputValidation\.infoBackground',
    'inputValidation\.infoBorder',
    'inputValidation\.warningBackground',
    'inputValidation\.warningBorder',
    'keybindingLabel\.background',
    'keybindingLabel\.border',
    'keybindingLabel\.bottomBorder',
    'keybindingLabel\.foreground',
    'keybindingTable\.headerBackground',
    'keybindingTable\.rowsBackground',
    'list\.activeSelectionIconForeground',
    'list\.deemphasizedForeground',
    'list\.dropBackground',
    'list\.errorForeground',
    'list\.filterMatchBackground',
    'list\.focusHighlightForeground',
    'list\.highlightForeground',
    'list\.inactiveSelectionIconForeground',
    'list\.invalidItemForeground',
    'list\.warningForeground',
    'listFilterWidget\.background',
    'listFilterWidget\.noMatchesOutline',
    'listFilterWidget\.outline',
    'listFilterWidget\.shadow',
    'menu\.background',
    'menu\.border',
    'menu\.separatorBackground',
    'menubar\.selectionBackground',
    'menubar\.selectionBorder',
    'merge\.commonContentBackground',
    'merge\.commonHeaderBackground',
    'merge\.incomingContentBackground',
    'merge\.incomingHeaderBackground',
    'minimap\.background',
    'minimap\.errorHighlight',
    'minimap\.findMatchHighlight',
    'minimap\.foregroundOpacity',
    'minimap\.selectionHighlight',
    'minimap\.selectionOccurrenceHighlight',
    'minimap\.warningHighlight',
    'minimapGutter\.addedBackground',
    'minimapGutter\.deletedBackground',
    'minimapGutter\.modifiedBackground',
    'minimapSlider\.activeBackground',
    'minimapSlider\.background',
    'minimapSlider\.hoverBackground',
    'notebook\.cellBorderColor',
    'notebook\.cellEditorBackground',
    'notebook\.cellHoverBackground',
    'notebook\.cellInsertionIndicator',
    'notebook\.cellStatusBarItemHoverBackground',
    'notebook\.cellToolbarSeparator',
    'notebook\.editorBackground',
    'notebook\.focusedCellBorder',
    'notebook\.focusedEditorBorder',
    'notebook\.inactiveFocusedCellBorder',
    'notebook\.selectedCellBackground',
    'notebook\.selectedCellBorder',
    'notebook\.symbolHighlightBackground',
    'notebookScrollbarSlider\.activeBackground',
    'notebookScrollbarSlider\.background',
    'notebookScrollbarSlider\.hoverBackground',
    'notebookStatusErrorIcon\.foreground',
    'notebookStatusRunningIcon\.foreground',
    'notebookStatusSuccessIcon\.foreground',
    'notificationCenter\.border',
    'notificationCenterHeader\.background',
    'notificationLink\.foreground',
    'notifications\.background',
    'notifications\.border',
    'notificationsErrorIcon\.foreground',
    'notificationsInfoIcon\.foreground',
    'notificationsWarningIcon\.foreground',
    'notificationToast\.border',
    'panel\.background',
    'panel\.border',
    'panel\.dropBorder',
    'panelInput\.border',
    'panelSection\.border',
    'panelSection\.dropBackground',
    'panelSectionHeader\.background',
    'panelSectionHeader\.border',
    'panelStickyScroll\.background',
    'panelStickyScroll\.shadow',
    'panelTitle\.activeBorder',
    'peekView\.border',
    'peekViewEditor\.background',
    'peekViewEditor\.matchHighlightBackground',
    'peekViewEditorGutter\.background',
    'peekViewEditorStickyScroll\.background',
    'peekViewResult\.background',
    'peekViewResult\.fileForeground',
    'peekViewResult\.lineForeground',
    'peekViewResult\.matchHighlightBackground',
    'peekViewResult\.selectionBackground',
    'peekViewTitle\.background',
    'peekViewTitleDescription\.foreground',
    'peekViewTitleLabel\.foreground',
    'pickerGroup\.border',
    'ports\.iconRunningProcessForeground',
    'problemsErrorIcon\.foreground',
    'problemsInfoIcon\.foreground',
    'problemsWarningIcon\.foreground',
    'progressBar\.background',
    'quickInput\.background',
    'quickInput\.foreground',
    'quickInputList\.focusBackground',
    'quickInputList\.focusForeground',
    'quickInputList\.focusIconForeground',
    'quickInputTitle\.background',
    'sash\.hoverBorder',
    'scm\.historyItemAdditionsForeground',
    'scm\.historyItemDeletionsForeground',
    'scm\.historyItemStatisticsBorder',
    'scrollbar\.shadow',
    'scrollbarSlider\.activeBackground',
    'scrollbarSlider\.background',
    'scrollbarSlider\.hoverBackground',
    'searchEditor\.findMatchBackground',
    'searchEditor\.findMatchBorder',
    'searchEditor\.textInputBorder',
    'selection\.background',
    'settings\.checkboxBackground',
    'settings\.checkboxBorder',
    'settings\.checkboxForeground',
    'settings\.dropdownBackground',
    'settings\.dropdownBorder',
    'settings\.dropdownListBorder',
    'settings\.focusedRowBackground',
    'settings\.focusedRowBorder',
    'settings\.headerBorder',
    'settings\.headerForeground',
    'settings\.modifiedItemIndicator',
    'settings\.numberInputBackground',
    'settings\.numberInputBorder',
    'settings\.numberInputForeground',
    'settings\.rowHoverBackground',
    'settings\.sashBorder',
    'settings\.settingsHeaderHoverForeground',
    'settings\.textInputBackground',
    'settings\.textInputBorder',
    'sideBar\.background',
    'sideBar\.border',
    'sideBar\.dropBackground',
    'sideBarSectionHeader\.background',
    'sideBarSectionHeader\.border',
    'sideBarTitle\.background',
    'sideBySideEditor\.horizontalBorder',
    'sideBySideEditor\.verticalBorder',
    'statusBar\.background',
    'statusBar\.border',
    'statusBar\.debuggingBackground',
    'statusBar\.debuggingBorder',
    'statusBar\.focusBorder',
    'statusBar\.noFolderBackground',
    'statusBar\.noFolderBorder',
    'statusBarItem\.activeBackground',
    'statusBarItem\.compactHoverBackground',
    'statusBarItem\.errorBackground',
    'statusBarItem\.errorForeground',
    'statusBarItem\.errorHoverBackground',
    'statusBarItem\.errorHoverForeground',
    'statusBarItem\.focusBorder',
    'statusBarItem\.hoverBackground',
    'statusBarItem\.hoverForeground',
    'statusBarItem\.prominentBackground',
    'statusBarItem\.prominentForeground',
    'statusBarItem\.prominentHoverBackground',
    'statusBarItem\.prominentHoverForeground',
    'statusBarItem\.remoteBackground',
    'statusBarItem\.remoteForeground',
    'statusBarItem\.remoteHoverBackground',
    'statusBarItem\.remoteHoverForeground',
    'statusBarItem\.warningBackground',
    'statusBarItem\.warningForeground',
    'statusBarItem\.warningHoverBackground',
    'statusBarItem\.warningHoverForeground',
    'symbolIcon\.arrayForeground',
    'symbolIcon\.booleanForeground',
    'symbolIcon\.classForeground',
    'symbolIcon\.colorForeground',
    'symbolIcon\.constantForeground',
    'symbolIcon\.constructorForeground',
    'symbolIcon\.enumeratorForeground',
    'symbolIcon\.enumeratorMemberForeground',
    'symbolIcon\.eventForeground',
    'symbolIcon\.fieldForeground',
    'symbolIcon\.fileForeground',
    'symbolIcon\.folderForeground',
    'symbolIcon\.functionForeground',
    'symbolIcon\.interfaceForeground',
    'symbolIcon\.keyForeground',
    'symbolIcon\.keywordForeground',
    'symbolIcon\.methodForeground',
    'symbolIcon\.moduleForeground',
    'symbolIcon\.namespaceForeground',
    'symbolIcon\.nullForeground',
    'symbolIcon\.numberForeground',
    'symbolIcon\.objectForeground',
    'symbolIcon\.operatorForeground',
    'symbolIcon\.packageForeground',
    'symbolIcon\.propertyForeground',
    'symbolIcon\.referenceForeground',
    'symbolIcon\.snippetForeground',
    'symbolIcon\.stringForeground',
    'symbolIcon\.structForeground',
    'symbolIcon\.textForeground',
    'symbolIcon\.typeParameterForeground',
    'symbolIcon\.unitForeground',
    'symbolIcon\.variableForeground',
    'tab\.activeBackground',
    'tab\.activeBorder',
    'tab\.activeBorderTop',
    'tab\.activeModifiedBorder',
    'tab\.border',
    'tab\.dragAndDropBorder',
    'tab\.hoverBackground',
    'tab\.hoverBorder',
    'tab\.hoverForeground',
    'tab\.inactiveBackground',
    'tab\.inactiveForeground',
    'tab\.inactiveModifiedBorder',
    'tab\.lastPinnedBorder',
    'tab\.selectedBackground',
    'tab\.selectedBorderTop',
    'tab\.selectedForeground',
    'tab\.unfocusedActiveBackground',
    'tab\.unfocusedActiveBorder',
    'tab\.unfocusedActiveBorderTop',
    'tab\.unfocusedActiveModifiedBorder',
    'tab\.unfocusedHoverBackground',
    'tab\.unfocusedHoverBorder',
    'tab\.unfocusedHoverForeground',
    'tab\.unfocusedInactiveBackground',
    'tab\.unfocusedInactiveForeground',
    'tab\.unfocusedInactiveModifiedBorder',
    'terminal\.ansiBlack',
    'terminal\.ansiBlue',
    'terminal\.ansiBrightBlack',
    'terminal\.ansiBrightBlue',
    'terminal\.ansiBrightCyan',
    'terminal\.ansiBrightGreen',
    'terminal\.ansiBrightMagenta',
    'terminal\.ansiBrightRed',
    'terminal\.ansiBrightWhite',
    'terminal\.ansiBrightYellow',
    'terminal\.ansiCyan',
    'terminal\.ansiGreen',
    'terminal\.ansiMagenta',
    'terminal\.ansiRed',
    'terminal\.ansiWhite',
    'terminal\.ansiYellow',
    'terminal\.background',
    'terminal\.border',
    'terminal\.dropBackground',
    'terminal\.findMatchBackground',
    'terminal\.findMatchBorder',
    'terminal\.findMatchHighlightBackground',
    'terminal\.findMatchHighlightBorder',
    'terminal\.foreground',
    'terminal\.hoverHighlightBackground',
    'terminal\.inactiveSelectionBackground',
    'terminal\.selectionBackground',
    'terminal\.selectionForeground',
    'terminal\.tab\.activeBorder',
    'terminalCommandDecoration\.defaultBackground',
    'terminalCommandDecoration\.errorBackground',
    'terminalCommandDecoration\.successBackground',
    'terminalCursor\.background',
    'terminalCursor\.foreground',
    'terminalOverviewRuler\.border',
    'terminalOverviewRuler\.cursorForeground',
    'terminalOverviewRuler\.findMatchForeground',
    'terminalStickyScroll\.background',
    'terminalStickyScroll\.shadow',
    'terminalStickyScrollHover\.background',
    'testing\.iconErrored',
    'testing\.iconFailed',
    'testing\.iconPassed',
    'testing\.iconQueued',
    'testing\.iconSkipped',
    'testing\.iconUnset',
    'testing\.message\.error\.decorationForeground',
    'testing\.message\.error\.lineBackground',
    'testing\.message\.hint\.decorationForeground',
    'testing\.message\.info\.decorationForeground',
    'testing\.message\.info\.lineBackground',
    'testing\.message\.warning\.decorationForeground',
    'testing\.message\.warning\.lineBackground',
    'testing\.peekBorder',
    'testing\.peekHeaderBackground',
    'testing\.runAction',
    'textBlockQuote\.background',
    'textBlockQuote\.border',
    'textCodeBlock\.background',
    'textLink\.activeForeground',
    'textLink\.foreground',
    'textPreformat\.background',
    'textPreformat\.foreground',
    'textSeparator\.foreground',
    'titleBar\.activeBackground',
    'titleBar\.activeForeground',
    'titleBar\.border',
    'titleBar\.inactiveBackground',
    'titleBar\.inactiveForeground',
    'toolbar\.activeBackground',
    'toolbar\.hoverBackground',
    'tree\.inactiveIndentGuidesStroke',
    'tree\.indentGuidesStroke',
    'tree\.tableColumnsBorder',
    'tree\.tableOddRowsBackground',
    'walkthrough\.embeddedEditorBackground',
    'walkThrough\.embeddedEditorBackground',
    'welcomePage\.background',
    'welcomePage\.progress\.background',
    'welcomePage\.progress\.foreground',
    'welcomePage\.tileBackground',
    'welcomePage\.tileHoverBackground',
    'welcomePage\.tileShadow',
    'widget\.border',
    'widget\.shadow',
    'window\.activeBorder',
    'window\.inactiveBorder'
)

# Fix each background property
$fixCount = 0
foreach ($prop in $backgroundProps) {
    $pattern = "`"$prop`":\s*`"#F5EFE7`""
    $replacement = "`"$($prop -replace '\\','')`": `"#3E2723`""
    if ($content -match $pattern) {
        $content = $content -replace $pattern, $replacement
        $fixCount++
    }
}

# Save
Set-Content -Path $espressoPath -Value $content -NoNewline

Write-Host "✅ Fixed $fixCount background properties" -ForegroundColor Green
Write-Host "   Changed #F5EFE7 (cream) → #3E2723 (espresso dark)" -ForegroundColor Gray
